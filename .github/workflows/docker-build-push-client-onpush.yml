name: Build & Push Docker Image on Push to Docker hub

on:
  push:                                #  Trigger only on "push" events
    branches:                          #  Restrict to the main branch
      - main
    paths:                             #  Restrict workflow to only run if certain files change
      - "client/**"                      #  Run only when files under auth/ folder are modified

jobs:
  build:
    runs-on: ubuntu-latest  # The virtual machine runner
                            # Locally: it's like running the build commands on your dev machine.

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4   # <-- this clones your repo into the runner

      - name: Log in to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
        # What it does: Authenticates to Docker Hub so pushes are allowed.
        # mandatory
        #  equivalent:
        #   bash> echo "$DOCKERHUB_TOKEN" | docker login --username "$DOCKERHUB_USERNAME" --password-stdin

      - name: Build and push image
        uses: docker/build-push-action@v6
        with:
          context: ./client              #  Must specify Docker file folder if it not in the root directory (auth service)
          push: true
          tags: ${{ secrets.DOCKERHUB_USERNAME }}/client:latest
        # What it does: Builds Docker image from repo context and pushes it.
        # Why it's mandatory: This is the coreâ€”build and push.
        # Real-world equivalent:
        #   bash> docker build -t youruser/yourrepo:pr-12 .
        #   bash> docker push youruser/yourrepo:pr-12
